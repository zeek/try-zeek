{"sources": [{"content": "event bro_init()\n    {\n    local r1 = SumStats::Reducer($stream=\"dns.lookups\", $apply=set(SumStats::TOPK), $topk_size=50);\n    SumStats::create([$name=\"top_dns_lookups\",\n                      $epoch=12hrs,\n                      $reducers=set(r1),\n                      $epoch_result(ts: time, key: SumStats::Key, result: SumStats::Result) =\n                        {\n                        local r = result[\"dns.lookups\"];\n                        local s: vector of SumStats::Observation;\n                        s = topk_get_top(r$topk, 10);\n                        print fmt(\"Top 10 DNS requests for %D through %D\", r$begin, r$end);\n                        for ( i in s )\n                            {\n                            if ( i == 10 )\n                                break;\n\n                            print fmt(\"   Name: %s (estimated count: %d)\", s[i]$str, topk_count(r$topk, s[i]));\n                            }\n                            # Add an extra line for nice formatting.\n                            print \"\";\n                        }]);\n    }\n\nevent dns_request(c: connection, msg: dns_msg, query: string, qtype: count, qclass: count)\n    {\n    if ( c$id$resp_p == 53/udp && query != \"\" )\n        SumStats::observe(\"dns.lookups\", [], [$str=query]);\n    }\n", "name": "main.bro"}]}